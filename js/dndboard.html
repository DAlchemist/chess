<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="../css/reset.css">
		<link rel="stylesheet" type="text/css" href="../css/style.css">
	</head>
	<body>
		
		<div class="container">
			<div class="number">
				
				<div class="letter"><img class="dragRook1" id="whiterook"  src="images/white_rook.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragKnight1" id="whiteknight"   src="images/white_knight.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragBishop1" id="whitebishop" src="images/white_bishop.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragQueen" id="whitequeen"  src="images/white_queen.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragKing" id="whiteking"  src="images/white_king.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragBishop2" id="whitebishop"  src="images/white_bishop.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragKnight2" id="whiteknight"  src="images/white_knight.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragRook2" id="whiterook"   src="images/white_rook.svg" width="70" height="70"></div>
			</div>
			<div class="number">
				<div class="letter"><img class="dragPawn1" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn2" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn3" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn4" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn5" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn6" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn7" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn8" id="whitepawn" src="images/white_pawn.svg" width="70" height="70"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"><img class="dragPawn1" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn2" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn3" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn4" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn5" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn6" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn7" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragPawn8" id="blackpawn" src="images/black_pawn.svg" width="70" height="70"></div>
			</div>
			<div class="number">
				<div class="letter"><img class="dragRook1" id="blackrook"  src="images/black_rook.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragKnight1" id="blackknight"  src="images/black_knight.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragBishop1" id="blackbishop"  src="images/black_bishop.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragKing" id="blackking"  src="images/black_king.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragQueen" id="blackqueen"  src="images/black_queen.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragBishop2" id="blackbishop"  src="images/black_bishop.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragKnight2" id="blackknight"  src="images/black_knight.svg" width="70" height="70"></div>
				<div class="letter"><img class="dragRook2" id="blackrook"  src="images/black_rook.svg" width="70" height="70"></div>
			</div>
		</div>
		
		<script type="text/javascript" src="lib/shims.js"></script>
        <script type="text/javascript" src="lib/underscore-min.js"></script>
        <script type="text/javascript" src="lib/jquery-2.0.3.min.js"></script>
       	
        <script type="text/javascript" src="jqueryUI/ui/jquery-ui.js"></script>
        <script type="text/javascript" src="lib/shiro/shiro-class.js"></script>
        <script type="text/javascript" src="lib/shiro/shiro-eventemitter.js"></script>
        <script type="text/javascript" src="attackedFields.js"></script>
        <script type="text/javascript">
        
        $(function() {
			
        	function MatrixWrite (matrix){
				var key;
	            for(var i = 0; i < matrix.length; i++){
	            	for (var j = 0; j < matrix[i].length; j++) {
	            		key = matrix[i][j];
	            		$('.engine').eq(i).children().eq(j).text(key);
	            	}
	            }    
	        }

	        function contains(arr, pair){
		        for (var i = 0; i < arr.length; i++) {
		            if( arr[i][0] === pair[0] && arr[i][1] === pair[1] ) return true;
		        }
		        return false;
		    }

			function drawBoard(){
				
				function countPositions (limit) {
					var positions = [];
					for (var i = 0; i < limit; i++) {
						positions.push(i);
					}
					return positions;
				}
				var pos = countPositions($('.letter').length);

				for (var k = 0; k<8; k++) {
					var order = k % 2 === 1 ? 1 : 2;
					for(var i = 0; i<8; i++ ) {
						var color; 
						if (order === 1 ) {
							i % 2 === 1 ? color = 'white' : color ='grey';
							$('.letter').eq(pos.shift()).css("background-color", color);
						} else {
							i % 2 === 1 ? color = 'grey' : color ='white';
				     		$('.letter').eq(pos.shift()).css("background-color", color);
				     	}
				     	
				    }//end second for
			    }//end first for
			}//end function
			
			function enableDraggable(element){

				var element_id = $(element).attr('class').split(' ')[0].substring(4);

				$(element).draggable({
					cursor: 'move',
					revert: true,
					revertDuration: 60,
					start:function(){
						initPos[element_id] = [$(this).parent().parent().index(),$(this).parent().index()]
						figMeth = $(this).attr('id').substring(5);
						figColor = $(this).attr('id').substring(0,5);
						figProp = $(this).attr('class').split(' ')[0].substring(4);
					}
				})
			}

			function createFigures(matrix){

		    	for (var k = 0; k < 8; k++) {
					matrix[0][k] = 1;
					matrix[1][k] = 1;
				}

				for (var i = 0; i < 8; i++) {
					matrix[6][i] = -1;
					matrix[7][i] = -1;
				}
			}


			$('.letter').addClass('drop');
			
			var figMeth, figProp, figColor;
			
			var initPos = { 
				Bishop1 : [], Bishop2 : [], Knight1 : [], 
				Knight2 : [], Queen : [], King : [], 
				Rook1   : [], Rook2 : [] 
			}

			var marker = {
 				white: {
 					Rook1: 1, Knight1: 2, Bishop1: 3, King: 4, 
 					Queen: 5, Bishop2: 6, Knight2: 7, Rook2: 8, 
 					Pawn1: 11, Pawn2: 12, Pawn3: 13, Pawn4: 14, 
 					Pawn5: 15, Pawn6: 16, Pawn7: 17, Pawn8: 18
 				},
 				black: {
 					Rook1: -1, Knight1: -2, Bishop1: -3, King: -4, 
 					Queen: -5, Bishop2: -6, Knight2: -7, Rook2: -8, 
 					Pawn1: -11, Pawn2: -12, Pawn3: -13, Pawn4: -14, 
 					Pawn5: -15, Pawn6: -16, Pawn7: -17, Pawn8: -18
 				}
 				
 			}

 			var figures_array = [
 				'.dragBishop1','.dragBishop2','.dragQueen','.dragKing',
				'.dragRook1','.dragRook2','.dragKnight1','.dragKnight2',
				'.dragPawn1','.dragPawn2','.dragPawn3','.dragPawn4',
				'.dragPawn5','.dragPawn6','.dragPawn7','.dragPawn8'
			];

			
			drawBoard();
			figures_array.forEach(enableDraggable);
			
			var chessEngine = new AttackedFieldgenerator();	
			var board = generateEmptyTable();

		   
			createFigures(board);

			var moveCounter = 0;
		    var allowed = 'white';

		  	$(".drop").droppable({

				drop: function(ev, ui) {
					
					var dropped = ui.draggable;
		            var droppedOn = $(this);
					var next = [$(this).parent().index(), $(this).index()]
		           
					var eatingValidation = contains(chessEngine[figMeth](board,initPos[figProp][0],initPos[figProp][1],figColor).em, next)
		            var movingValidation = contains(chessEngine[figMeth](board,initPos[figProp][0],initPos[figProp][1],figColor).pm, next)
		            
		        	var movable = chessEngine[figMeth](board,initPos[figProp][0],initPos[figProp][1],figColor).pm
		          	
		          	
		          	if (movingValidation && allowed===figColor) {

		          		board[initPos[figProp][0]][initPos[figProp][1]] = 0;
		          		board[next[0]][next[1]] = marker[figColor][figProp]
		          		MatrixWrite(board);
		          		
		          		if (moveCounter%2===0) {
		          			allowed = "black";
		          		} else {
		          			allowed = "white"
		          		}
		          		
		            	moveCounter++;

		            	$(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
		            	
		            } else if (eatingValidation && allowed===figColor){
		            	
		            	board[initPos[figProp][0]][initPos[figProp][1]] = 0;
		          		board[next[0]][next[1]] = marker[figColor][figProp]
		          		MatrixWrite(board);

		          		if (moveCounter%2===0) {
		          			allowed = "black";
		          		} else {
		          			allowed = "white"
		          		}

		          		moveCounter++;

		            	var deadOne = droppedOn.children()
		            	
						$(deadOne).detach().css({top: 0,left: 0});
		            	$(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
		          
					} else {
		            	return false;
		            }
		        }
		    });
		});
		</script>
	</body>
</html>