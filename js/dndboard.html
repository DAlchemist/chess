<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="../css/reset.css">
		<link rel="stylesheet" type="text/css" href="../css/style.css">
	</head>
	<body>
		
		<div class="container">
			<div class="number">
				<div class="letter"><img class="Rook1" id="whiterook"  src="images/whiterook.svg"></div>
				<div class="letter"><img class="Knight1" id="whiteknight"   src="images/whiteknight.svg" ></div>
				<div class="letter"><img class="Bishop1" id="whitebishop" src="images/whitebishop.svg"></div>
				<div class="letter"><img class="Queen" id="whitequeen"  src="images/whitequeen.svg" ></div>
				<div class="letter"><img class="King" id="whiteking"  src="images/whiteking.svg" ></div>
				<div class="letter"><img class="Bishop2" id="whitebishop"  src="images/whitebishop.svg" ></div>
				<div class="letter"><img class="Knight2" id="whiteknight"  src="images/whiteknight.svg" ></div>
				<div class="letter"><img class="Rook2" id="whiterook"   src="images/whiterook.svg" ></div>
			</div>
			<div class="number">
				<div class="letter"><img class="Pawn1" id="whitepawn" src="images/whitepawn.svg" ></div>
				<div class="letter"><img class="Pawn2" id="whitepawn" src="images/whitepawn.svg" ></div>
				<div class="letter"><img class="Pawn3" id="whitepawn" src="images/whitepawn.svg" ></div>
				<div class="letter"><img class="Pawn4" id="whitepawn" src="images/whitepawn.svg" ></div>
				<div class="letter"><img class="Pawn5" id="whitepawn" src="images/whitepawn.svg" ></div>
				<div class="letter"><img class="Pawn6" id="whitepawn" src="images/whitepawn.svg" ></div>
				<div class="letter"><img class="Pawn7" id="whitepawn" src="images/whitepawn.svg" ></div>
				<div class="letter"><img class="Pawn8" id="whitepawn" src="images/whitepawn.svg"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
				<div class="letter"></div>
			</div>
			<div class="number">
				<div class="letter"><img class="Pawn1" id="blackpawn" src="images/blackpawn.svg"></div>
				<div class="letter"><img class="Pawn2" id="blackpawn" src="images/blackpawn.svg"></div>
				<div class="letter"><img class="Pawn3" id="blackpawn" src="images/blackpawn.svg"></div>
				<div class="letter"><img class="Pawn4" id="blackpawn" src="images/blackpawn.svg"></div>
				<div class="letter"><img class="Pawn5" id="blackpawn" src="images/blackpawn.svg"></div>
				<div class="letter"><img class="Pawn6" id="blackpawn" src="images/blackpawn.svg"></div>
				<div class="letter"><img class="Pawn7" id="blackpawn" src="images/blackpawn.svg"></div>
				<div class="letter"><img class="Pawn8" id="blackpawn" src="images/blackpawn.svg"></div>
			</div>
			<div class="number">
				<div class="letter"><img class="Rook1" id="blackrook"  src="images/blackrook.svg" ></div>
				<div class="letter"><img class="Knight1" id="blackknight"  src="images/blackknight.svg" ></div>
				<div class="letter"><img class="Bishop1" id="blackbishop"  src="images/blackbishop.svg"></div>
				<div class="letter"><img class="King" id="blackking"  src="images/blackking.svg" ></div>
				<div class="letter"><img class="Queen" id="blackqueen"  src="images/blackqueen.svg"></div>
				<div class="letter"><img class="Bishop2" id="blackbishop"  src="images/blackbishop.svg" ></div>
				<div class="letter"><img class="Knight2" id="blackknight"  src="images/blackknight.svg"></div>
				<div class="letter"><img class="Rook2" id="blackrook"  src="images/blackrook.svg"></div>
			</div>
		</div>
		
		<script type="text/javascript" src="lib/shims.js"></script>
        <script type="text/javascript" src="lib/underscore-min.js"></script>
        <script type="text/javascript" src="lib/jquery-2.0.3.min.js"></script>
       	
        <script type="text/javascript" src="jqueryUI/ui/jquery-ui.js"></script>
        <script type="text/javascript" src="lib/shiro/shiro-class.js"></script>
        <script type="text/javascript" src="lib/shiro/shiro-eventemitter.js"></script>
        <script type="text/javascript" src="attackedFields.js"></script>
        <script type="text/javascript">
        
        $(function() {
			
        	function contains(arr, pair){
		        for (var i = 0; i < arr.length; i++) {
		            if( arr[i][0] === pair[0] && arr[i][1] === pair[1] ) return true;
		        }
		        return false;
		    }

		    /****************************/
		    /*physical functions*/
		    /****************************/

		    function MatrixWrite (matrix){
				var key;
	            for(var i = 0; i < matrix.length; i++){
	            	for (var j = 0; j < matrix[i].length; j++) {
	            		key = matrix[i][j];
	            		$('.engine').eq(i).children().eq(j).text(key);
	            	}
	            }    
	        }
			
			function drawBoard(){
				
				function countPositions (limit) {
					var positions = [];
					for (var i = 0; i < limit; i++) {
						positions.push(i);
					}
					return positions;
				}
				var pos = countPositions($('.letter').length);

				for (var k = 0; k<8; k++) {
					var order = k % 2 === 1 ? 1 : 2;
					for(var i = 0; i<8; i++ ) {
						var color; 
						if (order === 1 ) {
							i % 2 === 1 ? color = 'white' : color ='grey';
							$('.letter').eq(pos.shift()).css("background-color", color);
						} else {
							i % 2 === 1 ? color = 'grey' : color ='white';
				     		$('.letter').eq(pos.shift()).css("background-color", color);
				     	}
				     	
				    }//end second for
			    }//end first for
			}//end function
			
			function enableDraggable(element){
				
				var dotLess = element.substring(1);
				
				$(element).draggable({
					cursor: 'move',
					revert: true,
					revertDuration: 60,
					start:function(){
						initPos[dotLess] = [$(this).parent().parent().index(),$(this).parent().index()]
						figMeth = $(this).attr('id').substring(5);
						figColor = $(this).attr('id').substring(0,5);
						figProp = $(this).attr('class').split(' ')[0];
					}
				})
			}

			function createFigures(matrix,direction){
				
				for (var k = 0; k < 8; k++) {
					matrix[direction[0]][k] = 1;
					matrix[direction[1]][k] = 1;
				}

				for (var i = 0; i < 8; i++) {
					matrix[direction[2]][i] = -1;
					matrix[direction[3]][i] = -1;
				}
			}


			var figMeth, figProp, figColor;
			
			var initPos = { 
				Bishop1 : [], Bishop2 : [], Knight1 : [], 
				Knight2 : [], Queen : [], King : [], 
				Rook1   : [], Rook2 : [] 
			}

			var marker = {
 				white: {
 					Rook1: 1, Knight1: 1, Bishop1: 1, King: 1, 
 					Queen: 1, Bishop2: 1, Knight2: 1, Rook2: 1, 
 					Pawn1: 1, Pawn2: 1, Pawn3: 1, Pawn4: 1, 
 					Pawn5: 1, Pawn6: 1, Pawn7: 1, Pawn8: 1
 				},
 				black: {
 					Rook1: -1, Knight1: -1, Bishop1: -1, King: -1, 
 					Queen: -1, Bishop2: -1, Knight2: -1, Rook2: -1, 
 					Pawn1: -1, Pawn2: -1, Pawn3: -1, Pawn4: -1, 
 					Pawn5: -1, Pawn6: -1, Pawn7: -1, Pawn8: -1
 				}
 				
 			}

 			var figures_array = [
 				'.Bishop1','.Bishop2','.Queen','.King',
				'.Rook1','.Rook2','.Knight1','.Knight2',
				'.Pawn1','.Pawn2','.Pawn3','.Pawn4',
				'.Pawn5','.Pawn6','.Pawn7','.Pawn8'
			];


			/*******************************************************************************/
			/*GAME STARTER*/
			/*******************************************************************************/
			
			var direction = [0,1,6,7];	
			
			var board = generateEmptyTable();
			createFigures(board,direction);

			drawBoard();
			$('.letter').addClass('drop');
			
			/*import images with classes and their data*/
			/*TODO*/

			/*make images draggable*/
			figures_array.forEach(enableDraggable);


			/*******************************************************************************/

			var chessEngine = new AttackedFieldgenerator();
			var moveCounter = 0;
		    var allowed = 'white';

		  	$(".drop").droppable({

				drop: function(ev, ui) {
					
					var dropped = ui.draggable;
		            var droppedOn = $(this);
					var next = [$(this).parent().index(), $(this).index()]
		           
					var eatingValidation = contains(chessEngine[figMeth](board,initPos[figProp][0],initPos[figProp][1],figColor).em, next)
		            var movingValidation = contains(chessEngine[figMeth](board,initPos[figProp][0],initPos[figProp][1],figColor).pm, next)
		            
		        	var movable = chessEngine[figMeth](board,initPos[figProp][0],initPos[figProp][1],figColor).pm
		          	
		          	
		          	if (movingValidation && allowed===figColor) {

		          		board[initPos[figProp][0]][initPos[figProp][1]] = 0;
		          		board[next[0]][next[1]] = marker[figColor][figProp]
		          		MatrixWrite(board);
		          		
		          		if (moveCounter%2===0) {
		          			allowed = "black";
		          		} else {
		          			allowed = "white"
		          		}
		          		
		            	moveCounter++;

		            	$(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
		            	
		            } else if (eatingValidation && allowed===figColor){
		            	
		            	board[initPos[figProp][0]][initPos[figProp][1]] = 0;
		          		board[next[0]][next[1]] = marker[figColor][figProp]
		          		MatrixWrite(board);

		          		if (moveCounter%2===0) {
		          			allowed = "black";
		          		} else {
		          			allowed = "white"
		          		}

		          		moveCounter++;

		            	var deadOne = droppedOn.children()
		            	
						$(deadOne).detach().css({top: 0,left: 0});
		            	$(dropped).detach().css({top: 0,left: 0}).appendTo(droppedOn);
		          
					} else {
		            	return false;
		            }
		        }
		    });
		});
		</script>
	</body>
</html>